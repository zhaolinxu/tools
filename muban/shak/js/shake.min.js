function init(){window.DeviceMotionEvent?window.addEventListener("devicemotion",deviceMotionHandler,!1):alert("对不起，您的手机无法支持摇一摇！")}function deviceMotionHandler(e){var t=e.accelerationIncludingGravity;if(curTime=(new Date).getTime(),curTime-last_update>100&&1==canShake){var n=curTime-last_update;if(n>100){last_update=curTime,x=t.x,y=t.y,z=t.z;var i=Math.abs(x+y+z-last_x-last_y-last_z)/n*1e4;i>SHAKE_THRESHOLD&&void 0!=$("#innum").html()&&$("#innum").html()>0&&(count++,shake()),last_x=x,last_y=y,last_z=z}}}function shake(){canShake=0,$("#loading").attr("class","loading loading-show"),$("#se").css("display","none"),$("#res_bug").hide(),$("#res_bug").fadeIn(2e3,function(){}),$("#shakeup").animate({top:"10%"},500,function(){$("#shakeup").animate({top:"25%"},500,function(){$("#loading").attr("class","loading")})}),$("#shakedown").animate({top:"40%"},500,function(){$("#shakedown").animate({top:"25%"},500,function(){$("#se").css("display","block"),canShake=1,setTimeout(function(){0==count&&(findsound.play(),save())},2e3),count=0})}),sound.play()}function save(){$.getJSON("/lottery/config.do",{pagaId:pagaId[0],dataId:dataid[0]},function(e){e.success?(canShake=0,$("#lottery").html(e.msg),$("#innum").html(e.innum),setTimeout(function(){location.href="/mobile/pay.shtml?dealId="+e.dealid+"&backUri="+e.backUri},300)):($("#innum").html(e.innum),$("#res_bug").html(e.msg),$("#res_bug").show())})}var SHAKE_THRESHOLD=2700,last_update=0,last_time=0,count=0,x=y=z=last_x=last_y=last_z=0,canShake=1,sound=new Howl({urls:["http://static.ydmap.com.cn/themes/mobile/shake/sound/shake_sound.mp3"]}).load(),findsound=new Howl({urls:["http://static.ydmap.com.cn/themes/mobile/shake/sound/shake_match.mp3"]}).load(),curTime,isShakeble=!0;$(document).ready(function(){Howler.iOSAutoEnable=!1,FastClick.attach(document.body),init()});